<div class="weather-modal" tabindex="0" aria-modal="true" role="dialog">

  <!-- Loading overay -->
  <ng-container *ngIf="leadingWeather; else ready" class="loading-overlay">
    <p>Loading...</p>
  </ng-container>


  <ng-template #ready>
    <header class="wm-header">
      <div class="wm-title-wrapper">
        <h2>{{ name }}</h2>
        <p class="wm-last-updated-tag">
          Last updated at {{ data?.current?.time | date:'shortTime' }}.
        </p>
      </div>
      <button class="wm-close" (click)="closeModal.emit()" aria-label="Close">&times;</button>
    </header>


    <section *ngIf="data; else noData" class="wm-body">
      <!-- Quick Overview -->
      <div class="wm-overview">
        <div class="wm-stat wm-forecast">
          <div class="icon">📍</div>
          <div class="value">{{ stationWeather?.sg2hForecast }}</div>
          <div class="label">2-Hour Forecast</div>
        </div>

        <div class="wm-stat wm-temp">
          <div class="icon">🌡️</div>
          <div class="value">{{ stationWeather?.current.temperature }}°C</div>
          <div class="label">Temperature</div>
        </div>
        <div class="wm-stat wm-wind">
          <div class="icon">💨</div>
          <div class="value">{{ stationWeather?.current.windspeed }} km/h</div>
          <div class="label">Wind Speed</div>
        </div>
        <div class="wm-stat wm-direction">
          <div class="icon">🧭</div>
          <div class="value">{{ stationWeather?.current.winddirection }}°</div>
          <div class="label">Wind Dir.</div>
        </div>
      </div>

      <!-- Additional Details -->
      <div class="wm-details">
        <div class="detail-item">
          <strong>Coords:</strong>
          {{ stationWeather?.latitude.toFixed(4) }}, {{ stationWeather?.longitude.toFixed(4) }}
        </div>
        <div class="detail-item">
          <strong>Elevation:</strong>
          {{ stationWeather?.elevation }} m
        </div>
        <div class="detail-item">
          <strong>Timezone:</strong>
          {{ stationWeather?.timezoneAbbreviation }} (UTC{{ (stationWeather?.utcOffsetSeconds || 3600)/3600 |
          number:'1.0-0' }})
        </div>
        <div class="detail-item">
          <strong>API Latency:</strong>
          {{ stationWeather?.generationtimeMs | number:'1.0-2' }} ms
        </div>
      </div>

      <hr />

      <!-- Hourly Temp Chart -->
      <div class="wm-chart">
        <canvas baseChart [data]="lineChartData" [options]="lineChartOptions" [type]="lineChartType"></canvas>
      </div>


      <!-- Hourly Snapshot -->
      <div class="wm-hourly">
        <h3>Next 12 Hours</h3>

        <div class="hourly-grid">
          <div class="hourly-cell" *ngFor="let t of stationWeather?.hourly?.time?.slice(0,12); let i = index">
            <div class="hour">{{ t | date:'HH:mm' }}</div>
            <div class="hour-val">{{ stationWeather?.hourly?.temperature2m?.[i] }}°</div>
          </div>
        </div>
      </div>

      <!-- Debug Dump (dev only) -->
      <details class="wm-debug">
        <summary>Show Full Data</summary>
        <pre>{{ stationWeather | json }}</pre>
      </details>

    </section>
  </ng-template>

  <ng-template #noData>
    <div class="modal-empty">
      <p>❗ No data available for this station.</p>
    </div>
  </ng-template>
</div>
